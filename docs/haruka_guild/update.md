# 更新 & 问题记录

## *2022 / 11 / 27*

- 补丁已合并至主分支并正式发布
- 不出意外本文档不会再进行更新
- 需要在频道使用请前往 [官方文档](https://haruka-bot.sk415.icu/)


此处不再记录，请前往 [Releases](https://github.com/17TheWord/HarukaBot_Guild_Patch/releases) 查看

## *2022 / 8 / 22*

- **新添加：**
  - 子频道被删除时，删除该子频道的订阅列表
  - 清空 `群 / 子频道` 订阅列表
  - 一次 `添加 / 取消` 多个管理
  - 频道中的 `permission_check`


- **改动：**
    - 权限判定并入到 `utils` 的 `permission_check`


- **移除：**
  - 脚手架安装方法的 `启用频道适配补丁`


- **注意：**
    - FASTAPI_RELOAD
        - `Windows` 必须设置 `FASTAPI_RELOAD=false` 才能正常运行 `HarukaBot`
        - 在配置文件，如 `.env.dev`
        - 将 `FASTAPI_RELOAD=true`
        - 改为 `FASTAPI_RELOAD=false`

---

## *2022 / 8 / 20*

- **改动：**
    - 安装方法改动
        - `v1.4.1a60 测试版` 不再锁 `nonebot` 版本
        - 无需因pip安装修改 `utils` -> `__init__.py` 如下内容
            - `from nonebot.adapters.onebot.v11.exception import ActionFailed, NetworkError`
            - 改为
            - `from nonebot.adapters.onebot.v11 import ActionFailed, NetworkError`


- **注意：**
    - FASTAPI_RELOAD
        - `Windows` 必须设置 `FASTAPI_RELOAD=false` 才能正常运行 `HarukaBot`
        - 在配置文件，如 `.env.dev`
        - 将 `FASTAPI_RELOAD=true`
        - 改为 `FASTAPI_RELOAD=false`

---

## *2022 / 8 / 18*

- **改动：**
    - 安装方法改动
        - 原版 `haruka_bot`、`频道适配补丁` 均用 `脚手架` 或 `NoneBot2 插件商店` 安装
        - 在虚拟环境 `venv` -> `Lib` -> `site-packages` -> `haruka_bot` 依次替换文件
        - `utils` -> `__init__.py`
            - pip 安装
                - `from nonebot.adapters.onebot.v11.exception import ActionFailed, NetworkError`
                - 改为
                - `from nonebot.adapters.onebot.v11 import ActionFailed, NetworkError`


- **注意：**
    - FASTAPI_RELOAD
        - `Windows` 必须设置 `FASTAPI_RELOAD=false` 才能正常运行 `HarukaBot`
        - 在配置文件，如 `.env.dev`
        - 将 `FASTAPI_RELOAD=true`
        - 改为 `FASTAPI_RELOAD=false`

---

## *2022 / 8 / 9*

- **新增：**
  - 将 `频道ID + 子频道ID` 字段分割成两个字段
  - 配置文件设置 `超级用户ID` 与 `管理员身份组`


- **改动：**
  - 安装方法改动
    - 原版 `haruka_bot`、`频道适配补丁` 均用 `脚手架` 或 `NoneBot2 插件商店` 安装 
    - 在虚拟环境 `venv` -> `Lib` -> `site-packages` -> `haruka_bot` 依次替换文件
    - `utils` -> `__init__.py`
      - pip 安装
          - `from nonebot.adapters.onebot.v11.exception import ActionFailed, NetworkError`
          - 改为
          - `from nonebot.adapters.onebot.v11 import ActionFailed, NetworkError`
  
  - 推送方法修改，重写频道推送逻辑

  - 权限判断重写，一并挪至 `utils` -> `__init__.py`
  
  - 管理员操作调整

  - 频道超级用户ID
    - 安装方法改动，为方便管理，将插件目录下 `GuildSuperUsers.py` 删除
    - 在配置文件中通过 `Haruka_Guild_Super_User_List = ["xxx"]` 设置频道超级用户ID

  - FASTAPI_RELOAD
    - `Windows` 必须设置 `FASTAPI_RELOAD=false` 才能正常运行 `HarukaBot`
    - 在配置文件，如 `.env.dev`
    - 将 `FASTAPI_RELOAD=true` 改为 `FASTAPI_RELOAD=false`
    
  - `utils` 目录中 `__init__.py`
    - `from nonebot.adapters.onebot.v11.exception`
    - 改为
    - `from nonebot.adapters.onebot.V11`

---

## *2022 / 7 / 2*

- **新增：**
    - 支持`通过频道身份组` 设置 `Bot 管理员`
    - 支持`自定义身份组名称`
    - 支持`自定义多个身份组`
    - `身份组权限 Bug` 修复，现已支持


- **改动：**
    - 现已可以开启 `@ 机器人命令`，在最新版频道补丁中已实现 `@消息`
        - `Haruka_TO_ME=True` 或 `删除` 这一行代码


- **无改动：**
    - 频道超级用户列表：
        - 在频道命令中添加判定 `用户频道 ID` 是否在列表中，以暂时解决权限问题。
        - 该组用于管理对数据库中的管理员，将继续保留。
    - 指令添加频道管理员功能：
        - 频道超级用户可在频道中使用 `添加 / 取消 @ 频道用户` 来设置频道 `Bot 管理员`。
        - 管理员只能使用机器人的 `关注 / 取关` 功能，没有其他权限。


- **建议推送频道设为只读：**
    - 虽然暂时解决了权限问题，但频道主/频道管理员，你也不想让你的推送子频道充斥各种聊天信息吧。
    - ~~由于频道用户ID不同于QQ号，猜测超级用户不会生效~~ 已通过设置频道超级用户暂时解决。

---

## *2022 / 6 / 9_2*

- **新增：**
    - ~~支持通过频道身份组设置 `Bot 管理员`~~
    - ~~支持`自定义身份组名称`~~
    - ~~支持`自定义多个身份组`~~
    - 因为某些问题，发现 `Bug`，已取消


- **改动：**
    - 指令添加频道管理员功能：
        - 在超级用户使用 `管理员增减`、`管理列表` 操作时候，会将该用户的 `频道 ID` ~~展示出来~~替换为频道昵称，保护隐私。


- **无改动：**
    - 频道超级用户列表：
        - 在频道命令中添加判定 `用户频道 ID` 是否在列表中，以暂时解决权限问题。
        - 该组用于管理对数据库中的管理员，将继续保留。
    - 指令添加频道管理员功能：
        - 频道超级用户可在频道中使用 `添加 / 取消 @ 频道用户` 来设置频道 `Bot 管理员`。
        - 管理员只能使用机器人的 `关注 / 取关` 功能，没有其他权限。


- **仍旧建议：**
    - 关闭@机器人命令，因为不清楚频道与群的@方式是否相同 `Haruka_TO_ME=False`


- **建议推送频道设为只读：**
    - 虽然暂时解决了权限问题，但频道主/频道管理员，你也不想让你的推送子频道充斥各种聊天信息吧。
    - ~~由于频道用户ID不同于QQ号，猜测超级用户不会生效~~ 已通过设置频道超级用户暂时解决。

---

## *2022 / 6 / 9_1*

- **改动：**
    - 指令添加频道管理员功能：
        - 频道超级用户可在频道中使用 `添加 / 取消 @ 频道用户` 来设置频道Bot管理员。(非常方便)
        - 在超级用户使用 `管理员增减`、`管理列表` 操作时候，会将该用户的 `频道 ID` 展示出来。
        - 管理员只能使用机器人的 `关注 / 取关` 功能，没有其他权限。


- **无改动：**
    - 频道超级用户列表，在频道命令中添加判定 `用户频道 ID` 是否在列表中，以暂时解决权限问题。


- **仍旧建议：**
    - 关闭@机器人命令，因为不清楚频道与群的@方式是否相同 `Haruka_TO_ME=False`


- **建议推送频道设为只读：**
    - 虽然暂时解决了权限问题，但频道主/频道管理员，你也不想让你的推送子频道充斥各种聊天信息吧。
    - ~~由于频道用户ID不同于QQ号，猜测超级用户不会生效~~ 已通过设置频道超级用户暂时解决。

---

## *2022 / 6 / 8*

- **新增：**
    - 频道超级用户列表，在频道命令中添加判定 `用户频道 ID` 是否在列表中，以暂时解决权限问题。
    - 指令添加频道管理员功能：
        - 频道超级用户可在频道中使用 `添加 / 取消 用户频道ID` 来设置频道Bot管理员。
        - 管理员只能使用机器人的 `关注 / 取关` 功能，没有其他权限。


- **仍旧建议：**
    - 关闭@机器人命令，因为不清楚频道与群的@方式是否相同 `Haruka_TO_ME=False`


- **建议推送频道设为只读：**
    - 虽然暂时解决了权限问题，但频道主/频道管理员，你也不想让你的推送子频道充斥各种聊天信息吧。
    - ~~由于频道用户ID不同于QQ号，猜测超级用户不会生效~~ 已通过设置频道超级用户暂时解决。

---

## *2022 / 5 / 28*

- **新增：**
    - 频道超级用户列表，在频道命令中添加判定 `频道用户 ID` 是否在列表中，以暂时解决权限问题


- **仍旧建议：**
    - 关闭 `@ 机器人` 命令，因为不清楚频道与群的 `@ 方式` 是否相同 `Haruka_TO_ME=False`


- **建议推送频道设为只读：**
    - 虽然暂时解决了权限问题，但 `频道主 / 频道管理员`，你也不想让你的推送子频道充斥各种聊天信息吧。
    - 由于 `频道用户 ID` 不同于 `QQ 号`，猜测超级用户不会生效

---

## *2022 / 5 / 26-2*

- **建议：**
    - **关闭** `@ 机器人` 命令，因为不清楚频道与群的 `@ 方式` 是否相同 `Haruka_TO_ME=False`


- ~~建议~~ **强烈建议**推送频道设为只读：
    - 由于 `频道用户 ID` 不同于 `QQ 号`，**猜测** 超级用户不会生效
    - 经测试，频道内不存在权限系统，任何人都可以使用命令，在使用时请慎重检查频道人员成分

---

## *2022 / 5 / 26-1*

- 因为不清楚频道与群的 `@ 方式` 是否相同，建议 **关闭** `@ 机器人` 命令 `Haruka_TO_ME=False`


- 因数据库中数据类型改动，需要删除数据库重新订阅！！！！！！


- 建议推送频道设为只读，频道内权限与群内权限不一定相同（应该是不同的，在频道内输入开启权限并没有什么反应）